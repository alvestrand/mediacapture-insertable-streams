<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>MediaStreamTrack Insertable Media Processing using Streams</title>
  <meta content="UD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-UD" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version 8804d24d, updated Tue Sep 1 16:57:28 2020 +0200" name="generator">
  <link href="https://w3c.github.io/mediacapture-insertable-streams/" rel="canonical">
  <meta content="ed1869fa0c76d21ce98c3d61f62b0e622f692903" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: #005a9c;
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: #DDDDDD;
    color: black;
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: black; }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: gray;
    color: white;
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: black;
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
.highlight:not(.idl) { background: hsl(24, 20%, 95%); }
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">MediaStreamTrack Insertable Media Processing using Streams</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">Unofficial Proposal Draft, <time class="dt-updated" datetime="2020-11-03">3 November 2020</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/mediacapture-insertable-streams/">https://w3c.github.io/mediacapture-insertable-streams/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webrtc@w3.org?subject=%5Bmediacapture-insertable-streams%5D%20YOUR%20TOPIC%20HERE">public-webrtc@w3.org</a> with subject line “<kbd>[mediacapture-insertable-streams] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webrtc/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/mediacapture-insertable-streams/issues/">GitHub</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hta@google.com">Harald Alvestrand</a> (<a class="p-org org" href="https://google.com">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:guidou@google.com">Guido Urdaneta</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2020 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This API defines an API surface for manipulating the bits on <code class="idl"><a data-link-type="idl">MediaStreamTrack</a></code>s carrying raw data.
NOT AN ADOPTED WORKING GROUP DOCUMENT.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#terminology"><span class="secno">2</span> <span class="content">Terminology</span></a>
    <li>
     <a href="#specification"><span class="secno">3</span> <span class="content">Specification</span></a>
     <ol class="toc">
      <li>
       <a href="#operation"><span class="secno">3.1</span> <span class="content">Extension operation</span></a>
       <ol class="toc">
        <li><a href="#stream-creation"><span class="secno">3.1.1</span> <span class="content">Stream creation</span></a>
        <li><a href="#stream-processing"><span class="secno">3.1.2</span> <span class="content">Stream processing</span></a>
        <li><a href="#stream-control"><span class="secno">3.1.3</span> <span class="content">Stream control</span></a>
       </ol>
     </ol>
    <li><a href="#examples"><span class="secno">4</span> <span class="content">Examples</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>The <a data-link-type="biblio" href="#biblio-webrtc-nv-use-cases">[WEBRTC-NV-USE-CASES]</a> document describes several functions that
can only be achieved by access to media (requirements N20-N22),
including, but not limited to:</p>
   <ul>
    <li data-md>
     <p>Funny Hats</p>
    <li data-md>
     <p>Machine Learning</p>
    <li data-md>
     <p>Virtual Reality Gaming</p>
   </ul>
   <p>These use cases further require that processing can be done in worker
threads (requirement N23-N24).</p>
   <p>This specification gives an interface inspired by <a data-link-type="biblio" href="#biblio-web-codecs">[WEB-CODECS]</a> to
provide access to such functionality.</p>
   <p>This specification provides access to raw media,
which is the output of a media source such as a camera, microphone, screen capture,
or the decoder part of a codec and the input to the
decoder part of a codec. The processed media can be consumed by any destination
that can take a MediaStreamTrack, including HTML &lt;video> and &lt;audio> tags,
RTCPeerConnection, canvas or MediaRecorder.</p>
   <h2 class="heading settled" data-level="2" id="terminology"><span class="secno">2. </span><span class="content">Terminology</span><a class="self-link" href="#terminology"></a></h2>
   <h2 class="heading settled" data-level="3" id="specification"><span class="secno">3. </span><span class="content">Specification</span><a class="self-link" href="#specification"></a></h2>
   <p>This specification shows the IDL extensions for <a data-link-type="biblio" href="#biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]</a></p>
   <p>It defines some new objects that inherit the <code class="idl"><a data-link-type="idl">MediaStreamTrack</a></code> interface, and
can be constructed from a <code class="idl"><a data-link-type="idl">MediaStreamTrack</a></code>.</p>
   <p>The first part - Breakout Box Phase Two - specifies a track tht can be created from
a MediaStreamTrack, and offers a ReadableStream and a WritableStream; the client is expected to connect
a TransformStream (or equivalent) between the two, and let it do the media processing.</p>
<pre class="idl highlight def"><c- b>interface</c-> <dfn class="idl-code" data-dfn-type="interface" data-export id="processingmediastreamtrack"><code><c- g>ProcessingMediaStreamTrack</c-></code><a class="self-link" href="#processingmediastreamtrack"></a></dfn> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <dfn class="idl-code" data-dfn-for="ProcessingMediaStreamTrack" data-dfn-type="constructor" data-export data-lt="ProcessingMediaStreamTrack(source)|constructor(source)" id="dom-processingmediastreamtrack-processingmediastreamtrack"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-processingmediastreamtrack-processingmediastreamtrack"></a></dfn>(<a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> <dfn class="idl-code" data-dfn-for="ProcessingMediaStreamTrack/ProcessingMediaStreamTrack(source), ProcessingMediaStreamTrack/constructor(source)" data-dfn-type="argument" data-export id="dom-processingmediastreamtrack-processingmediastreamtrack-source-source"><code><c- g>source</c-></code><a class="self-link" href="#dom-processingmediastreamtrack-processingmediastreamtrack-source-source"></a></dfn>);
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class" id="ref-for-rs-class"><c- n>ReadableStream</c-></a> <dfn class="idl-code" data-dfn-for="ProcessingMediaStreamTrack" data-dfn-type="attribute" data-export data-type="ReadableStream" id="dom-processingmediastreamtrack-readable"><code><c- g>readable</c-></code><a class="self-link" href="#dom-processingmediastreamtrack-readable"></a></dfn>;  // Stream of {{VideoFrame}}
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class" id="ref-for-ws-class"><c- n>WritableStream</c-></a> <dfn class="idl-code" data-dfn-for="ProcessingMediaStreamTrack" data-dfn-type="attribute" data-export data-type="WritableStream" id="dom-processingmediastreamtrack-writable"><code><c- g>writable</c-></code><a class="self-link" href="#dom-processingmediastreamtrack-writable"></a></dfn>;  // Stream of VideoFrame
};
</pre>
   <p>The second part - Breakout Box Phase Three - specifies two elements: One is a track sink that is
capable of exposing the unencoded frames from the track to a ReadableStream, and exposes a control
channel for signals going in the oppposite direction. The other one is the inverse of that: It takes
video frames as input, and emits control signals that result from subsequent processing.</p>
<pre class="idl highlight def"><c- b>interface</c-> <dfn class="idl-code" data-dfn-type="interface" data-export id="trackprocessor"><code><c- g>TrackProcessor</c-></code><a class="self-link" href="#trackprocessor"></a></dfn> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <dfn class="idl-code" data-dfn-for="TrackProcessor" data-dfn-type="constructor" data-export data-lt="TrackProcessor(source)|constructor(source)" id="dom-trackprocessor-trackprocessor"><code><c- g>constructor</c-></code><a class="self-link" href="#dom-trackprocessor-trackprocessor"></a></dfn>(<a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> <dfn class="idl-code" data-dfn-for="TrackProcessor/TrackProcessor(source), TrackProcessor/constructor(source)" data-dfn-type="argument" data-export id="dom-trackprocessor-trackprocessor-source-source"><code><c- g>source</c-></code><a class="self-link" href="#dom-trackprocessor-trackprocessor-source-source"></a></dfn>);
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class" id="ref-for-rs-class①"><c- n>ReadableStream</c-></a> <dfn class="idl-code" data-dfn-for="TrackProcessor" data-dfn-type="attribute" data-export data-type="ReadableStream" id="dom-trackprocessor-readable"><code><c- g>readable</c-></code><a class="self-link" href="#dom-trackprocessor-readable"></a></dfn>;  // Stream of VideoFrame
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class" id="ref-for-ws-class①"><c- n>WritableStream</c-></a> <dfn class="idl-code" data-dfn-for="TrackProcessor" data-dfn-type="attribute" data-export data-type="WritableStream" id="dom-trackprocessor-writable"><code><c- g>writable</c-></code><a class="self-link" href="#dom-trackprocessor-writable"></a></dfn>;
};

<c- b>interface</c-> <dfn class="idl-code" data-dfn-type="interface" data-export id="trackgenerator"><code><c- g>TrackGenerator</c-></code><a class="self-link" href="#trackgenerator"></a></dfn> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class" id="ref-for-ws-class②"><c- n>WritableStream</c-></a> <dfn class="idl-code" data-dfn-for="TrackGenerator" data-dfn-type="attribute" data-export data-type="WritableStream" id="dom-trackgenerator-readable"><code><c- g>readable</c-></code><a class="self-link" href="#dom-trackgenerator-readable"></a></dfn>;
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class" id="ref-for-rs-class②"><c- n>ReadableStream</c-></a> <dfn class="idl-code" data-dfn-for="TrackGenerator" data-dfn-type="attribute" data-export data-type="ReadableStream" id="dom-trackgenerator-writable"><code><c- g>writable</c-></code><a class="self-link" href="#dom-trackgenerator-writable"></a></dfn>;
};

<c- b>dictionary</c-> <dfn class="idl-code" data-dfn-type="dictionary" data-export id="dictdef-controlsignal"><code><c- g>ControlSignal</c-></code><a class="self-link" href="#dictdef-controlsignal"></a></dfn> {
  <c- b>required</c-> <a class="n" data-link-type="idl-name" href="#enumdef-controlsignalname" id="ref-for-enumdef-controlsignalname"><c- n>ControlSignalName</c-></a> <dfn class="idl-code" data-dfn-for="ControlSignal" data-dfn-type="dict-member" data-export data-type="ControlSignalName " id="dom-controlsignal-name"><code><c- g>name</c-></code><a class="self-link" href="#dom-controlsignal-name"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long" id="ref-for-idl-long"><c- b>long</c-></a> <dfn class="idl-code" data-dfn-for="ControlSignal" data-dfn-type="dict-member" data-export data-type="long " id="dom-controlsignal-width"><code><c- g>width</c-></code><a class="self-link" href="#dom-controlsignal-width"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long" id="ref-for-idl-long①"><c- b>long</c-></a> <dfn class="idl-code" data-dfn-for="ControlSignal" data-dfn-type="dict-member" data-export data-type="long " id="dom-controlsignal-height"><code><c- g>height</c-></code><a class="self-link" href="#dom-controlsignal-height"></a></dfn>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double" id="ref-for-idl-double"><c- b>double</c-></a> <dfn class="idl-code" data-dfn-for="ControlSignal" data-dfn-type="dict-member" data-export data-type="double " id="dom-controlsignal-framerate"><code><c- g>frameRate</c-></code><a class="self-link" href="#dom-controlsignal-framerate"></a></dfn>;
  <a class="n" data-link-type="idl-name"><c- n>PixelFormat</c-></a> <dfn class="idl-code" data-dfn-for="ControlSignal" data-dfn-type="dict-member" data-export data-type="PixelFormat " id="dom-controlsignal-pixelformat"><code><c- g>pixelFormat</c-></code><a class="self-link" href="#dom-controlsignal-pixelformat"></a></dfn>;
};

<c- b>enum</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="enum" data-export id="enumdef-controlsignalname"><code><c- g>ControlSignalName</c-></code></dfn> {
  <dfn class="idl-code" data-dfn-for="ControlSignalName" data-dfn-type="enum-value" data-export id="dom-controlsignalname-stop"><code><c- s>"stop"</c-></code><a class="self-link" href="#dom-controlsignalname-stop"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="ControlSignalName" data-dfn-type="enum-value" data-export id="dom-controlsignalname-mute"><code><c- s>"mute"</c-></code><a class="self-link" href="#dom-controlsignalname-mute"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="ControlSignalName" data-dfn-type="enum-value" data-export id="dom-controlsignalname-unmute"><code><c- s>"unmute"</c-></code><a class="self-link" href="#dom-controlsignalname-unmute"></a></dfn>,
  <dfn class="idl-code" data-dfn-for="ControlSignalName" data-dfn-type="enum-value" data-export id="dom-controlsignalname-configure"><code><c- s>"configure"</c-></code><a class="self-link" href="#dom-controlsignalname-configure"></a></dfn>,
};

</pre>
   <h3 class="heading settled" data-level="3.1" id="operation"><span class="secno">3.1. </span><span class="content">Extension operation</span><a class="self-link" href="#operation"></a></h3>
   <h4 class="heading settled" data-level="3.1.1" id="stream-creation"><span class="secno">3.1.1. </span><span class="content">Stream creation</span><a class="self-link" href="#stream-creation"></a></h4>
   <h4 class="heading settled" data-level="3.1.2" id="stream-processing"><span class="secno">3.1.2. </span><span class="content">Stream processing</span><a class="self-link" href="#stream-processing"></a></h4>
   <h4 class="heading settled" data-level="3.1.3" id="stream-control"><span class="secno">3.1.3. </span><span class="content">Stream control</span><a class="self-link" href="#stream-control"></a></h4>
   <p>The control signal set is platform-defined, but is intended to be extensible. By default, a
TrackProcessor coupled with a TrackGenerator should be able to pass the signals unchanged
to the other side.</p>
   <p>All signals are ignorable; the downstream objects will do whatever makes sense with frames
sent on the stream, no matter what the signals indicate.</p>
   <p>The "stop" and "mute" signals both indicate that frames should no longer be sent. "stop" indicates that the
MediaStreamTrack has stopped, and that no frames will ever be required again.</p>
   <p>THe "configure" signal has semantics equivalent to ApplyConstraints on the MediaStreamTrack, with all
constraints set to "ideal": It indicates that more efficient downstream processing will be achieved if
subsequently generated frames conform to the size and rate constrains given.</p>
   <h2 class="heading settled" data-level="4" id="examples"><span class="secno">4. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <p>--coming</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content"> Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p> Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification. </p>
   <p> All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p> Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this: </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a> This is an example of an informative example. </div>
   <p> Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this: </p>
   <p class="note" role="note"> Note, this is an informative note. </p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#dom-controlsignalname-configure">"configure"</a><span>, in §3</span>
   <li>
    constructor(source)
    <ul>
     <li><a href="#dom-processingmediastreamtrack-processingmediastreamtrack">constructor for ProcessingMediaStreamTrack</a><span>, in §3</span>
     <li><a href="#dom-trackprocessor-trackprocessor">constructor for TrackProcessor</a><span>, in §3</span>
    </ul>
   <li><a href="#dictdef-controlsignal">ControlSignal</a><span>, in §3</span>
   <li><a href="#enumdef-controlsignalname">ControlSignalName</a><span>, in §3</span>
   <li><a href="#dom-controlsignal-framerate">frameRate</a><span>, in §3</span>
   <li><a href="#dom-controlsignal-height">height</a><span>, in §3</span>
   <li><a href="#dom-controlsignalname-mute">"mute"</a><span>, in §3</span>
   <li><a href="#dom-controlsignal-name">name</a><span>, in §3</span>
   <li><a href="#dom-controlsignal-pixelformat">pixelFormat</a><span>, in §3</span>
   <li><a href="#processingmediastreamtrack">ProcessingMediaStreamTrack</a><span>, in §3</span>
   <li><a href="#dom-processingmediastreamtrack-processingmediastreamtrack">ProcessingMediaStreamTrack(source)</a><span>, in §3</span>
   <li>
    readable
    <ul>
     <li><a href="#dom-processingmediastreamtrack-readable">attribute for ProcessingMediaStreamTrack</a><span>, in §3</span>
     <li><a href="#dom-trackgenerator-readable">attribute for TrackGenerator</a><span>, in §3</span>
     <li><a href="#dom-trackprocessor-readable">attribute for TrackProcessor</a><span>, in §3</span>
    </ul>
   <li><a href="#dom-controlsignalname-stop">"stop"</a><span>, in §3</span>
   <li><a href="#trackgenerator">TrackGenerator</a><span>, in §3</span>
   <li><a href="#trackprocessor">TrackProcessor</a><span>, in §3</span>
   <li><a href="#dom-trackprocessor-trackprocessor">TrackProcessor(source)</a><span>, in §3</span>
   <li><a href="#dom-controlsignalname-unmute">"unmute"</a><span>, in §3</span>
   <li><a href="#dom-controlsignal-width">width</a><span>, in §3</span>
   <li>
    writable
    <ul>
     <li><a href="#dom-processingmediastreamtrack-writable">attribute for ProcessingMediaStreamTrack</a><span>, in §3</span>
     <li><a href="#dom-trackgenerator-writable">attribute for TrackGenerator</a><span>, in §3</span>
     <li><a href="#dom-trackprocessor-writable">attribute for TrackProcessor</a><span>, in §3</span>
    </ul>
  </ul>
  <aside class="dfn-panel" data-for="term-for-rs-class">
   <a href="https://streams.spec.whatwg.org/#rs-class">https://streams.spec.whatwg.org/#rs-class</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-rs-class">3. Specification</a> <a href="#ref-for-rs-class①">(2)</a> <a href="#ref-for-rs-class②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ws-class">
   <a href="https://streams.spec.whatwg.org/#ws-class">https://streams.spec.whatwg.org/#ws-class</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ws-class">3. Specification</a> <a href="#ref-for-ws-class①">(2)</a> <a href="#ref-for-ws-class②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-double">
   <a href="https://heycam.github.io/webidl/#idl-double">https://heycam.github.io/webidl/#idl-double</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-double">3. Specification</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-long">
   <a href="https://heycam.github.io/webidl/#idl-long">https://heycam.github.io/webidl/#idl-long</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-long">3. Specification</a> <a href="#ref-for-idl-long①">(2)</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-rs-class" style="color:initial">ReadableStream</span>
     <li><span class="dfn-paneled" id="term-for-ws-class" style="color:initial">WritableStream</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-double" style="color:initial">double</span>
     <li><span class="dfn-paneled" id="term-for-idl-long" style="color:initial">long</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-streams">[STREAMS]
   <dd>Adam Rice; Domenic Denicola; 吉野剛史 (Takeshi Yoshino). <a href="https://streams.spec.whatwg.org/">Streams Standard</a>. Living Standard. URL: <a href="https://streams.spec.whatwg.org/">https://streams.spec.whatwg.org/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]
   <dd>Daniel Burnett; et al. <a href="https://www.w3.org/TR/mediacapture-streams/">Media Capture and Streams</a>. 3 October 2017. CR. URL: <a href="https://www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
   <dt id="biblio-web-codecs">[WEB-CODECS]
   <dd><a href="https://github.com/WICG/web-codecs/blob/master/explainer.md">Web Codecs explainer</a>. URL: <a href="https://github.com/WICG/web-codecs/blob/master/explainer.md">https://github.com/WICG/web-codecs/blob/master/explainer.md</a>
   <dt id="biblio-webrtc-nv-use-cases">[WEBRTC-NV-USE-CASES]
   <dd>Bernard Aboba. <a href="https://www.w3.org/TR/webrtc-nv-use-cases/">WebRTC Next Version Use Cases</a>. 11 December 2018. WD. URL: <a href="https://www.w3.org/TR/webrtc-nv-use-cases/">https://www.w3.org/TR/webrtc-nv-use-cases/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>interface</c-> <a href="#processingmediastreamtrack"><code><c- g>ProcessingMediaStreamTrack</c-></code></a> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <a href="#dom-processingmediastreamtrack-processingmediastreamtrack"><code><c- g>constructor</c-></code></a>(<a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> <a href="#dom-processingmediastreamtrack-processingmediastreamtrack-source-source"><code><c- g>source</c-></code></a>);
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class"><c- n>ReadableStream</c-></a> <a data-type="ReadableStream" href="#dom-processingmediastreamtrack-readable"><code><c- g>readable</c-></code></a>;  // Stream of {{VideoFrame}}
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class"><c- n>WritableStream</c-></a> <a data-type="WritableStream" href="#dom-processingmediastreamtrack-writable"><code><c- g>writable</c-></code></a>;  // Stream of VideoFrame
};

<c- b>interface</c-> <a href="#trackprocessor"><code><c- g>TrackProcessor</c-></code></a> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <a href="#dom-trackprocessor-trackprocessor"><code><c- g>constructor</c-></code></a>(<a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> <a href="#dom-trackprocessor-trackprocessor-source-source"><code><c- g>source</c-></code></a>);
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class"><c- n>ReadableStream</c-></a> <a data-type="ReadableStream" href="#dom-trackprocessor-readable"><code><c- g>readable</c-></code></a>;  // Stream of VideoFrame
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class"><c- n>WritableStream</c-></a> <a data-type="WritableStream" href="#dom-trackprocessor-writable"><code><c- g>writable</c-></code></a>;
};

<c- b>interface</c-> <a href="#trackgenerator"><code><c- g>TrackGenerator</c-></code></a> : <a class="n" data-link-type="idl-name"><c- n>MediaStreamTrack</c-></a> {
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#ws-class"><c- n>WritableStream</c-></a> <a data-type="WritableStream" href="#dom-trackgenerator-readable"><code><c- g>readable</c-></code></a>;
    <c- b>attribute</c-> <a class="n" data-link-type="idl-name" href="https://streams.spec.whatwg.org/#rs-class"><c- n>ReadableStream</c-></a> <a data-type="ReadableStream" href="#dom-trackgenerator-writable"><code><c- g>writable</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-controlsignal"><code><c- g>ControlSignal</c-></code></a> {
  <c- b>required</c-> <a class="n" data-link-type="idl-name" href="#enumdef-controlsignalname"><c- n>ControlSignalName</c-></a> <a data-type="ControlSignalName " href="#dom-controlsignal-name"><code><c- g>name</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long"><c- b>long</c-></a> <a data-type="long " href="#dom-controlsignal-width"><code><c- g>width</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-long"><c- b>long</c-></a> <a data-type="long " href="#dom-controlsignal-height"><code><c- g>height</c-></code></a>;
  <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-double"><c- b>double</c-></a> <a data-type="double " href="#dom-controlsignal-framerate"><code><c- g>frameRate</c-></code></a>;
  <a class="n" data-link-type="idl-name"><c- n>PixelFormat</c-></a> <a data-type="PixelFormat " href="#dom-controlsignal-pixelformat"><code><c- g>pixelFormat</c-></code></a>;
};

<c- b>enum</c-> <a href="#enumdef-controlsignalname"><code><c- g>ControlSignalName</c-></code></a> {
  <a href="#dom-controlsignalname-stop"><code><c- s>"stop"</c-></code></a>,
  <a href="#dom-controlsignalname-mute"><code><c- s>"mute"</c-></code></a>,
  <a href="#dom-controlsignalname-unmute"><code><c- s>"unmute"</c-></code></a>,
  <a href="#dom-controlsignalname-configure"><code><c- s>"configure"</c-></code></a>,
};


</pre>
  <aside class="dfn-panel" data-for="enumdef-controlsignalname">
   <b><a href="#enumdef-controlsignalname">#enumdef-controlsignalname</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-enumdef-controlsignalname">3. Specification</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>